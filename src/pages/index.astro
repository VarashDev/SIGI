---
// @ts-nocheck
import Layout from "../layouts/Layout.astro";
import AddRecordForm from "../components/AddRecordForm.astro";
import TodaysRecords from "../components/TodaysRecords.astro";

import { SignedIn, SignedOut, UserButton, SignInButton } from '@clerk/astro/components'

import { db, Record, desc, sql, like } from 'astro:db';
import { eq, and } from 'drizzle-orm';

const uaDate = new Date().toLocaleDateString("uk-UA", {
  timeZone: "Europe/Kyiv",
  dateStyle: "long",
});

const { userId } = Astro.locals.auth()

if (Astro.request.method === 'POST') {
  const formData = await Astro.request.formData();
  const reason = formData.get('reason');
  const recorded = new Date();
  if (typeof reason === 'string') {
    // Insert form data into the Comment table
    await db.insert(Record).values({ reason, recorded, userId });
  }
}




---
<Layout
title="Sigi"
>

<SignedIn>

  <AddRecordForm />

<h1 class="text-xl font-semibold m-4">{uaDate}</h1>

<TodaysRecords server:defer>
  <div class="flex justify-center items-center py-6">
    <svg
      class="animate-spin h-8 w-8 text-amber-500"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
    >
      <circle
        class="opacity-25"
        cx="12"
        cy="12"
        r="10"
        stroke="currentColor"
        stroke-width="4"
      ></circle>
      <path
        class="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
      ></path>
    </svg>
    <span class="ml-3 text-gray-600 text-sm">Завантаження…</span>
  </div>
</TodaysRecords>

</SignedIn>
<SignedOut>
  You should be logged in.
</SignedOut>
</Layout>